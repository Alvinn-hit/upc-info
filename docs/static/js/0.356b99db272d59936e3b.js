webpackJsonp([0],{"/Mmb":function(t,e){},"3Xzh":function(t,e){},"3cXf":function(t,e,n){t.exports={default:n("LERP"),__esModule:!0}},"9l0A":function(t,e){},AA3o:function(t,e,n){"use strict";e.__esModule=!0,e.default=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},Cj8Q:function(t,e,n){"use strict";var a=n("AA3o"),i=n.n(a),s=n("xSur"),o=n.n(s),r=n("d2gY"),u=n("hrn7"),c=function(){function t(e,n,a){i()(this,t),l.call(this),this.commonUrl=null!==e&&void 0!==e?e:this.commonUrl,this.fetchBefore=n,this.fetchAfter=a}return o()(t,[{key:"_getData",value:function(t,e){var n=this;for(var a in this.fetchBefore&&this.fetchBefore(),t+="?Authorization="+u.a.getLocalToken(),e)e.hasOwnProperty(a)&&(t+=a+"="+e[a]+"&");return t=this.commonUrl+t,console.log("get method",t),fetch(t,{method:"get"}).then(function(t){return n.fetchAfter&&n.fetchAfter(),t})}},{key:"_postData",value:function(t,e){var n=this;this.fetchBefore&&this.fetchBefore(),t+="?Authorization="+u.a.getLocalToken();var a=new FormData;for(var i in e)e.hasOwnProperty(i)&&a.append(i,e[i]);return console.log("POST method",this.commonUrl+t),console.log("formData",e),fetch(this.commonUrl+t,{method:"post",body:e,fd:a}).then(function(t){return n.fetchAfter&&n.fetchAfter(),t})}},{key:"getJsonData",value:function(t,e){return this._getData(t,e).then(function(t){return t.json()})}},{key:"getTextData",value:function(t,e){return this._getData(t,e).then(function(t){return t.text()})}},{key:"postJsonData",value:function(t,e){return this._postData(t,e).then(function(t){return t.json()})}},{key:"postTextData",value:function(t,e){return this._postData(t,e).then(function(t){return t.text()})}}]),t}(),l=function(){this.commonUrl=r.a},h=c,f=function(){function t(e,n){i()(this,t),this.uploadUrl="/upload/file",this.httpRequest=new h(e),this.uploadUrl=null!==n&&void 0!==n?n:this.uploadUrl}return o()(t,[{key:"fetchFile",value:function(t,e,n){var a=(n=null!==n&&void 0!==n?n:document).createElement("form");a.appendChild(t.cloneNode());var i=new FormData(a);return"text"===e?this.httpRequest.postTextData(this.uploadUrl,i).then(function(t){return d+"/"+t.data}):this.httpRequest.postJsonData(this.uploadUrl,i).then(function(t){return d+"/"+t.data})}}]),t}();n.d(e,"c",function(){return v}),n.d(e,"b",function(){return d});var d="http://yb.upc.edu.cn",p=new h("http://yb.upc.edu.cn:8085"),v=new f("http://yb.upc.edu.cn:8084");e.a=p},Dmm8:function(t,e,n){var a=n("34sJ");a(a.S+a.F*!n("GdxE"),"Object",{defineProperty:n("QYYr").f})},EhUw:function(t,e){},HEqH:function(t,e){},IaMB:function(t,e,n){t.exports=n.p+"static/img/loading.e450664.gif"},LERP:function(t,e,n){var a=n("yDNk"),i=a.JSON||(a.JSON={stringify:JSON.stringify});t.exports=function(t){return i.stringify.apply(i,arguments)}},d2gY:function(t,e,n){"use strict";n.d(e,"a",function(){return a}),n.d(e,"c",function(){return i}),n.d(e,"b",function(){return s});var a="http://yb.upc.edu.cn:8084/",i="yb_uid",s="verify_request"},egpO:function(t,e,n){"use strict";var a={name:"Header",data:function(){return{token:123}},beforeMount:function(){null!==this._props.title&&void 0!==this._props.title&&(document.querySelector("title").innerHTML=this._props.title);var t=this._props.yibanAuth;t&&t.fetchVq(),t&&t.refreshToken()},props:["title","yibanAuth"]},i={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"header"},[this._t("default")],2)},staticRenderFns:[]};var s=n("Z0/y")(a,i,!1,function(t){n("HEqH")},null,null);e.a=s.exports},h6Bq:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n("egpO"),i={mounted:function(){this._props.value&&(this.inputValue=this._props.value)},methods:{input:function(t){this.$emit("userInput",{key:this._props.dataKey,value:t.target.value})}}},s={name:"InputBox",mixins:[i],props:["type","placeholder","classes","value","dataKey"],data:function(){return{inputValue:""}}},o={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"InputBox",on:{change:this.input}},[e("label",[e("input",{class:this.classes,attrs:{type:this.type,name:this.dataKey,placeholder:this.placeholder},domProps:{value:this.inputValue}})])])},staticRenderFns:[]};var r=n("Z0/y")(s,o,!1,function(t){n("9l0A")},null,null).exports,u={name:"TextBox",mixins:[i],props:["placeholder","classes","value","dataKey"],data:function(){return{inputValue:""}}},c={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"TextBox",on:{change:this.input}},[e("label",[e("textarea",{class:this.classes,attrs:{name:this.dataKey,cols:"10",rows:"4",placeholder:this.placeholder},domProps:{value:this.inputValue}})])])},staticRenderFns:[]};var l=n("Z0/y")(u,c,!1,function(t){n("/Mmb")},null,null).exports,h={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"Upload"},[e("input",{attrs:{type:"file",name:"file"},on:{change:this.upload}}),this._v(" "),this._m(0)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"add-button absolute-center"},[e("div",{staticClass:"add box-center"},[this._v("+")]),this._v(" "),e("p",[this._v("添加")])])}]};var f=n("Z0/y")({name:"Upload",data:function(){return{}},methods:{upload:function(t){this.$emit("addFile",t.target)}}},h,!1,function(t){n("EhUw")},null,null).exports,d={name:"Classification",props:["classesList","maxShow","maxChoose","dataKey"],data:function(){return{chooseList:[]}},methods:{choose:function(t){var e=this,n=parseInt(t.target.dataset.index),a=this.chooseList.indexOf(n);-1===a?this.chooseList.push(n):this.chooseList.splice(a,1);var i=this.chooseList.map(function(t){return e._props.classesList[t]});this.$emit("choose",{key:this._props.dataKey,value:i})},includes:function(t){return-1===this.chooseList.indexOf(t)?"":"border-color:black;color:black"}}},p={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"Classification"},[n("br"),t._v(" "),n("ul",{staticClass:"clear",on:{click:t.choose}},t._l(t.classesList,function(e,a){return n("li",{staticClass:"float-left",style:""+t.includes(a),attrs:{"data-index":a}},[n("span",{attrs:{"data-index":a}},[t._v(t._s(e))])])}))])},staticRenderFns:[]};var v=n("Z0/y")(d,p,!1,function(t){n("3Xzh")},null,null).exports,m=n("Cj8Q"),g=n("lWYf"),y={methods:{updateData:function(t){this[t.key]=t.value}}},_=n("3cXf"),b=n.n(_);var x=function(t){return t.fetch.postJsonData("/secondhand/publish/article",{name:t.managerTitle,kind:b()(t.chooseList),detail:t.managerMessage,imgurl:b()(t.fileList),price:t.managerPrice,degree:"未添加崭新度"})};var w={name:"PublishPage",mixins:[y,function(t){return{data:function(){var e=this;return t.fetchBefore=function(){return e.showLoading=!0},{loading:n("IaMB"),showLoading:!1,fetch:t}}}}(m.a)],data:function(){return{managerPrice:"",managerTitle:"",managerMessage:"",fileList:[],yibanAuth:g.a,classesList:["女装","男装","二手书籍"],chooseList:[]}},components:{HeaderSection:a.a,InputBox:r,TextBox:l,Upload:f,Classification:v},created:function(){var t=this;this.fetch.getJsonData("/secondhand/browse/allkind").then(function(e){t.classesList=e.map(function(t){return t.name})})},methods:{addFile:function(t){var e=this;m.c.fetchFile(t).then(function(t){console.log(t),e.fileList.push(t)})},deleteImage:function(t){var e=parseInt(t.target.dataset.index);this.fileList=this.fileList.filter(function(t,n){return n!==e})},userPublish:function(){var t=parseInt(this.managerPrice);isNaN(t)?alert("请在价格框中输入数字"):x(this).then(function(t){console.log(t)})}}},k={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"PublishPage box-center"},[n("header-section",{attrs:{title:"发布",yibanAuth:t.yibanAuth}},[n("p",[t._v("发布")])]),t._v(" "),t.showLoading?n("div",{staticClass:"box-center text-center"},[n("img",{staticStyle:{width:"133px",height:"80px"},attrs:{src:t.loading,alt:"正在加载中"}})]):t._e(),t._v(" "),n("input-box",{staticClass:"input-box box-center",attrs:{type:"text",placeholder:"标题",dataKey:"managerTitle",value:t.managerTitle},on:{userInput:t.updateData}}),t._v(" "),n("input-box",{staticClass:"input-box box-center",attrs:{type:"text",placeholder:"价格",dataKey:"managerPrice",value:t.managerPrice},on:{userInput:t.updateData}}),t._v(" "),n("br"),t._v(" "),n("text-box",{staticClass:"input-box box-center",attrs:{placeholder:"宝贝描述",dataKey:"managerMessage",value:t.managerMessage},on:{userInput:t.updateData}}),t._v(" "),n("div",{staticClass:"file-list input-box box-center"},[t._l(t.fileList,function(e,a){return n("div",{staticClass:"file-item"},[n("div",{staticClass:"add-icon text-center",attrs:{"data-index":a},on:{click:t.deleteImage}},[t._v("+")]),t._v(" "),n("img",{attrs:{src:e,alt:"图片加载失败"}}),t._v(" "),n("div",{staticClass:"file-item-footer text-center"},[t._v(t._s(0===a?"主图":"附图"))])])}),t._v(" "),n("upload",{staticClass:"upload file-item",on:{addFile:t.addFile}})],2),t._v(" "),n("br"),n("br"),t._v(" "),n("div",{staticClass:"clear input-box box-center"},[n("p",{staticStyle:{"font-size":"1rem",color:"#7F7F7F"}},[t._v("分类描述")]),t._v(" "),n("classification",{attrs:{classesList:t.classesList,dataKey:"chooseList"},on:{choose:t.updateData}})],1),t._v(" "),n("br"),t._v(" "),n("div",{staticClass:"input-box text-center upload-message box-center",on:{click:t.userPublish}},[t._v("\n        确认发布\n    ")])],1)},staticRenderFns:[]};var L=n("Z0/y")(w,k,!1,function(t){n("wey5")},null,null);e.default=L.exports},hrn7:function(t,e,n){"use strict";var a=n("AA3o"),i=n.n(a),s=n("xSur"),o=n.n(s),r=n("d2gY"),u=function(){function t(e){i()(this,t),this.httpRequest=e}return o()(t,[{key:"fetchTokenByeText",value:function(t,e,n){var a=new FormData;return a.append("appName",t),a.append("vq",n),a.append("device",e),fetch(this.httpRequest.commonUrl+"/auth",{method:"POST",body:a}).then(function(t){return window.a=t,t.json()}).then(function(t){window.sessionStorage.token=t.token})}}]),t}();var c=function(){var t={},e=window.location.href.split("?")[1].split("&");console.log(e);for(var n=0;n<e.length;n++)t[e[n].split("=")[0]]=e[n].split("=")[1];return t};n.d(e,"a",function(){return h}),n.d(e,"b",function(){return l});var l=function(){function t(e,n,a,s){i()(this,t),this.yibanIdKey=r.c,this.vqKey=r.b,this.vqUrl=e,this.httpRequest=n,this.appName=a,this.device=s}return o()(t,[{key:"fetchVq",value:function(){!1===this.haveVq()&&(window.localStorage.backUrl=window.location.href,window.location=this.vqUrl)}},{key:"haveVq",value:function(){var t=this.getVq();return null!==t&&void 0!==t}},{key:"getVq",value:function(){var t=this.getVqByUrl();return null!==t&&void 0!==t?(this.setVq(t),t):window.sessionStorage.vq}},{key:"setVq",value:function(t){window.sessionStorage.vq=t}},{key:"refreshToken",value:function(){new u(this.httpRequest).fetchTokenByeText(this.appName,this.device,this.getVq())}},{key:"getVqByUrl",value:function(){var t=window.location.href;if(!t.includes("?")&&!t.includes("=")&&!t.includes(this.vqKey))return null;var e=c();return window.sessionStorage.yibanId=e[r.c],window.sessionStorage.vq=e[r.b],window.location=window.localStorage.backUrl,e[r.b]}}]),t}(),h=function(){function t(){i()(this,t)}return o()(t,null,[{key:"haveLocalToken",value:function(){var t=window.sessionStorage.token;return null!==t&&void 0!==t}},{key:"getLocalToken",value:function(){return window.sessionStorage.token}},{key:"haveLocalUserData",value:function(){var t=window.localStorage.userData;return null!==t&&void 0!==t&&""!==t}},{key:"getLocalUserData",value:function(){return JSON.parse(window.localStorage.userData)}}]),t}()},lWYf:function(t,e,n){"use strict";var a=n("hrn7"),i=n("Cj8Q"),s=new a.b("https://openapi.yiban.cn/oauth/authorize?client_id=ee3cf6b53f16b07f&redirect_uri=http://f.yiban.cn/iapp218463",i.a,"second","mobile");e.a=s},liLe:function(t,e,n){t.exports={default:n("zg6Y"),__esModule:!0}},wey5:function(t,e){},xSur:function(t,e,n){"use strict";e.__esModule=!0;var a,i=n("liLe"),s=(a=i)&&a.__esModule?a:{default:a};e.default=function(){function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),(0,s.default)(t,a.key,a)}}return function(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),e}}()},zg6Y:function(t,e,n){n("Dmm8");var a=n("yDNk").Object;t.exports=function(t,e,n){return a.defineProperty(t,e,n)}}});
//# sourceMappingURL=0.356b99db272d59936e3b.js.map
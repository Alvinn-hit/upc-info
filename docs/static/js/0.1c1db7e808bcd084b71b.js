webpackJsonp([0],{"/MSx":function(t,e,n){"use strict";var o={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"header"},[this._t("default")],2)},staticRenderFns:[]};var i=n("Z0/y")({name:"HeaderSection",data:function(){return{}}},o,!1,function(t){n("7l/q")},"data-v-dbb65914",null);e.a=i.exports},"/qaa":function(t,e,n){"use strict";var o=n("kuiR"),i=n("hrn7");var r=function(t,e,n,r,a){var u,c=new o.a(t),s=new i.b(e,new o.a(t),n,r,(u=window.location,console.log("backUrl",a),void(window.localStorage.backUrl=u.origin+u.pathname+a)));return c.yibanAuth=s,{httpRequest:c,yibanAuth:s}},a=n("AA3o"),u=n.n(a),c=n("xSur"),s=n.n(c),h=function(){function t(e,n,o){u()(this,t),this.uploadUrl="/upload/file",this.filePrefix="http://yb.upc.edu.cn",this.httpRequest=e,n&&(this.filePrefix=n),this.uploadUrl=null!==o&&void 0!==o?o:this.uploadUrl}return s()(t,[{key:"fetchFile",value:function(t,e,n){var o=this,i=(n=null!==n&&void 0!==n?n:document).createElement("form");i.appendChild(t.cloneNode());var r=new FormData(i);return"text"===e?this.httpRequest.postTextData(this.uploadUrl,r).then(function(t){return o.filePrefix+"/"+t.data}):this.httpRequest.postJsonData(this.uploadUrl,r).then(function(t){return o.filePrefix+"/"+t.data})}}]),t}();n.d(e,"a",function(){return l}),n.d(e,"c",function(){return d}),n.d(e,"b",function(){return p});var f=r("http://yb.upc.edu.cn:8084","https://openapi.yiban.cn/oauth/authorize?client_id=ee3cf6b53f16b07f&redirect_uri=http://f.yiban.cn/iapp218463","second","mobile","#/second/home-page"),l=f.httpRequest,d=f.yibanAuth,v=new o.a("http://yb.upc.edu.cn:8084");v.yibanAuth=d;var p=new h(v,"http://yb.upc.edu.cn")},"7l/q":function(t,e){},IaMB:function(t,e,n){t.exports=n.p+"static/img/loading.e450664.gif"},c7dQ:function(t,e,n){"use strict";e.a=function(t){return{data:function(){return{title:"没有设置title,请详细阅读代码文档",yibanAuth:t}},watch:{title:function(t){document.querySelector("title").innerHTML=t}},created:function(){this.yibanAuth&&this.yibanAuth.fetchVq(),document.querySelector("title").innerHTML=this.title}}}},d2gY:function(t,e,n){"use strict";n.d(e,"a",function(){return o}),n.d(e,"c",function(){return i}),n.d(e,"b",function(){return r});var o="http://yb.upc.edu.cn:8084/",i="yb_uid",r="verify_request"},hrn7:function(t,e,n){"use strict";var o=n("3cXf"),i=n.n(o),r=n("AA3o"),a=n.n(r),u=n("xSur"),c=n.n(u),s=function(){function t(e){a()(this,t),this.httpRequest=e}return c()(t,[{key:"fetchTokenByText",value:function(t,e,n){var o=new FormData;return o.append("appName",t),o.append("vq",n),o.append("device",e),fetch(this.httpRequest.commonUrl+"/auth",{method:"POST",body:o}).then(function(t){return t.json()}).then(function(t){return window.sessionStorage.token=t.token,t.token})}}]),t}();var h=function(){var t={},e=window.location.href.split("?")[1].split("&");console.log(e);for(var n=0;n<e.length;n++)t[e[n].split("=")[0]]=e[n].split("=")[1];return t},f=n("kuiR"),l=n("d2gY");n.d(e,"a",function(){return v}),n.d(e,"b",function(){return d});var d=function(){function t(e,n,o,i,r){a()(this,t),this.yibanIdKey=l.c,this.vqKey=l.b,this.vqUrl=e,this.httpRequest=n,this.appName=o,this.device=i,this.fetchVqBefore=r}return c()(t,[{key:"fetchVq",value:function(){this.fetchVqBefore&&this.fetchVqBefore(),!1===this.haveVq()&&(window.localStorage.backUrl=window.location.href,window.location=this.vqUrl)}},{key:"haveVq",value:function(){var t=this.getVq();return null!==t&&void 0!==t}},{key:"getVq",value:function(){var t=this.getVqByUrl();return null!==t&&void 0!==t?(this.setVq(t),t):window.sessionStorage.vq}},{key:"setVq",value:function(t){window.sessionStorage.vq=t}},{key:"refreshToken",value:function(){return new s(this.httpRequest).fetchTokenByText(this.appName,this.device,this.getVq())}},{key:"getVqByUrl",value:function(){var t=window.location.href;if(!t.includes("?")&&!t.includes("=")&&!t.includes(this.vqKey))return null;var e=h();return console.log(e),window.sessionStorage.yibanId=e[l.c],window.sessionStorage.vq=e[l.b],window.history.pushState({},"",window.localStorage.backUrl),e[l.b]}}]),t}(),v=function(){function t(){a()(this,t)}return c()(t,null,[{key:"haveLocalToken",value:function(){var t=window.sessionStorage.token;return null!==t&&void 0!==t&&"null"!==t&&"undefined"!==t}},{key:"getLocalToken",value:function(){return window.sessionStorage.token}},{key:"haveLocalUserData",value:function(){var t=window.sessionStorage.userData;return null!==t&&void 0!==t&&"null"!==t&&"undefined"!==t}},{key:"getLocalUserData",value:function(){return JSON.parse(window.sessionStorage.userData)}},{key:"fetchUserData",value:function(){var t={yibanId:"yb_userid",exp:"yb_exp",money:"yb_money",schoolId:"yb_schoolid",schoolName:"yb_schoolname",sex:"yb_sex",userName:"yb_username",userNick:"yb_usernick"};return new f.a("http://yb.upc.edu.cn:8084").getJsonData("/leinuo/weekcp/user/getYiMeByToken").then(function(e){var n=JSON.parse(e.data);for(var o in t)n[o]=n[t[o]];return window.sessionStorage.userData=i()(n),n})}}]),t}()},kuiR:function(t,e,n){"use strict";var o=n("AA3o"),i=n.n(o),r=n("xSur"),a=n.n(r),u=n("d2gY"),c=n("hrn7"),s=function(){function t(e){var n=this;i()(this,t),h.call(this),this.commonUrl=null!==e&&void 0!==e?e:this.commonUrl,this.addFetchListen("error",function(t){window.r=t,"TypeError: Failed to fetch"===t.toString()&&n.yibanAuth&&n.yibanAuth.haveVq()&&console.log("请检查网络连接")})}return a()(t,[{key:"addFetchListen",value:function(t,e){"before"===t?this._fetchBefore.push(e):"after"===t?this._fetchAfter.push(e):this._fetchError.push(e)}},{key:"removeFetchListen",value:function(t,e){var n=void 0;"before"===t?-1!==(n=this._fetchBefore.indexOf(e))&&this._fetchBefore.splice(n,1):"after"===t?-1!==(n=this._fetchAfter.indexOf(e))&&this._fetchAfter.splice(n,1):-1!==(n=this._fetchError.indexOf(e))&&this._fetchError.splice(n,1)}},{key:"_fetchCheckToken",value:function(t,e,n){var o=this;return!c.a.haveLocalToken()&&this.yibanAuth?this.yibanAuth.refreshToken().then(function(){return o._fetchWithListener(t,e,n)}):this._fetchWithListener(t,e,n)}},{key:"_fetchWithListener",value:function(t,e,n){var o=this,i=void 0;if("GET"===t.toUpperCase())i=this._getData.bind(this);else{if("POST"!==t.toUpperCase())return console.log("不支持提交put与delete方法");i=this._postData.bind(this)}return this._fetchBefore&&this._fetchBefore.forEach(function(t){return t(e,n)}),i(e,n).catch(function(t){return console.log(t.toString()),o._fetchError&&o._fetchError.forEach(function(e){return e(t)})}).then(function(t){return o._fetchAfter&&o._fetchAfter.forEach(function(e){return e(t)}),t})}},{key:"_getData",value:function(t,e){for(var n in t+="?",e)e.hasOwnProperty(n)&&(t+=n+"="+e[n]+"&");return t+="Authorization="+c.a.getLocalToken(),t=this.commonUrl+t,console.log("get method",t),fetch(t,{method:"get"})}},{key:"_postData",value:function(t,e){t+="?Authorization="+c.a.getLocalToken();var n=new FormData;if(e instanceof FormData)n=e;else for(var o in e)e.hasOwnProperty(o)&&n.append(o,e[o]);return console.log("POST method",this.commonUrl+t,e),fetch(this.commonUrl+t,{method:"post",body:n})}},{key:"checkJsonData",value:function(t){return t.status&&500===t.status}},{key:"getJsonData",value:function(t,e){var n=this;return this._fetchCheckToken("get",t,e).then(function(t){return t.json()}).then(function(o){return n.checkJsonData(o)&&console.log("与后端交互出错","GET "+t,e),o})}},{key:"getTextData",value:function(t,e){return this._fetchCheckToken("get",t,e).then(function(t){return t.text()})}},{key:"postJsonData",value:function(t,e){var n=this;return this._fetchCheckToken("post",t,e).then(function(t){return t.json()}).then(function(o){return n.checkJsonData(o)&&console.log("与后端交互出错","POST "+t,e),o})}},{key:"postTextData",value:function(t,e){return this._fetchCheckToken("post",t,e).then(function(t){return t.text()})}}]),t}(),h=function(){this.commonUrl=u.a,this._fetchBefore=[],this._fetchAfter=[],this._fetchError=[]};e.a=s},mi6u:function(t,e,n){"use strict";e.a=function(t){return{data:function(){return{loadState:!1,fetch:t}},methods:{showLoading:function(){this.loadState=!0},hiddenLoading:function(){this.loadState=!1}},created:function(){this.fetch.addFetchListen("before",this.showLoading),this.fetch.addFetchListen("after",this.hiddenLoading)},beforeDestroy:function(){this.fetch.removeFetchListen("before",this.showLoading),this.fetch.removeFetchListen("after",this.hiddenLoading)}}}},nuAC:function(t,e,n){"use strict";var o={methods:{updateData:function(t){console.log(t),this[t.key]=t.value}}};e.a=o}});
//# sourceMappingURL=0.1c1db7e808bcd084b71b.js.map